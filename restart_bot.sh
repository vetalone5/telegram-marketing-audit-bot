#!/bin/bash

# ๐ค ะกะบัะธะฟั ะดะปั ะฑััััะพะณะพ ะฟะตัะตะทะฐะฟััะบะฐ ะปะพะบะฐะปัะฝะพะณะพ Telegram ะฑะพัะฐ ั ะปะพะณะฐะผะธ
# ะัะฟะพะปัะทะพะฒะฐะฝะธะต: ./restart_bot.sh

set -e

echo "๐ ะััะฐะฝะฐะฒะปะธะฒะฐะตะผ ััะฐััะต ะฟัะพัะตััั ะฑะพัะฐ..."

# ะฃะฑะธะฒะฐะตะผ ะฒัะต ะฟัะพัะตััั ะฑะพัะฐ
pkill -f "app.telegram.bot" 2>/dev/null || echo "   โน๏ธ  ะัะพัะตััั ะฑะพัะฐ ะฝะต ะฝะฐะนะดะตะฝั"

# ะะดะตะผ ะทะฐะฒะตััะตะฝะธั ะฟัะพัะตััะพะฒ
sleep 2

echo "๐๏ธ  ะฃะดะฐะปัะตะผ ัะฐะนะป ะฑะปะพะบะธัะพะฒะบะธ..."
rm -f /tmp/marketgaze_bot.lock

echo "๐ ะะฐะฟััะบะฐะตะผ ะฑะพัะฐ ั ะปะพะณะฐะผะธ ะฒ ัะตัะผะธะฝะฐะปะต..."
echo "   (ะดะปั ะพััะฐะฝะพะฒะบะธ ะฝะฐะถะผะธัะต Ctrl+C)"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"

# ะญะบัะฟะพััะธััะตะผ PATH ะดะปั Poetry
export PATH="$HOME/.local/bin:$PATH"

# ะะฐะฟััะบะฐะตะผ ะฑะพัะฐ ะะะ ัะพะฝะพะฒะพะณะพ ัะตะถะธะผะฐ - ะปะพะณะธ ะฑัะดัั ะฒ ัะตัะผะธะฝะฐะปะต
poetry run python -m app.telegram.bot